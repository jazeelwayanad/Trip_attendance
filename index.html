<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>Tour Attendance</title>
                <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
                    <style>
                            /* CSS Styles */
                                    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background-color: #f3f4f6; padding: 20px; display: flex; justify-content: center; }
                                            .app-container { background: white; width: 100%; max-width: 400px; padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
                                                    h1 { text-align: center; color: #111827; margin-bottom: 5px; font-size: 1.5rem; }
                                                            p.sub { text-align: center; color: #6b7280; font-size: 0.9rem; margin-top: 0; }
                                                                    
                                                                            /* Form Elements */
                                                                                    input { width: 100%; padding: 14px; margin: 8px 0; border: 1px solid #d1d5db; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
                                                                                            button { width: 100%; padding: 14px; background-color: #2563eb; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; margin-top: 10px; }
                                                                                                    button:disabled { background-color: #93c5fd; }
                                                                                                            
                                                                                                                    /* Utility */
                                                                                                                            .hidden { display: none; }
                                                                                                                                    .success { color: #059669; text-align: center; margin-top: 10px; font-weight: bold; display: none; }
                                                                                                                                            
                                                                                                                                                    /* Admin Section */
                                                                                                                                                            .admin-bar { background: #eff6ff; padding: 10px; border-radius: 8px; text-align: center; margin-bottom: 15px; border: 1px solid #bfdbfe; }
                                                                                                                                                                    .count { font-size: 1.2rem; font-weight: bold; color: #1e40af; }
                                                                                                                                                                            
                                                                                                                                                                                    .list-container { max-height: 350px; overflow-y: auto; border-top: 1px solid #eee; margin-top: 10px; }
                                                                                                                                                                                            .student-row { display: flex; justify-content: space-between; padding: 12px 5px; border-bottom: 1px solid #f3f4f6; }
                                                                                                                                                                                                    .reg-badge { background: #e5e7eb; padding: 2px 8px; border-radius: 12px; font-size: 0.85rem; color: #374151; }
                                                                                                                                                                                                            
                                                                                                                                                                                                                    .reset-btn { background-color: #dc2626; margin-top: 20px; }
                                                                                                                                                                                                                            .toggle { display: block; text-align: center; margin-top: 20px; font-size: 0.8rem; color: #9ca3af; text-decoration: underline; cursor: pointer; }
                                                                                                                                                                                                                                </style>
                                                                                                                                                                                                                                </head>
                                                                                                                                                                                                                                <body>

                                                                                                                                                                                                                                <div class="app-container">
                                                                                                                                                                                                                                    <h1>üöå Tour Tracker</h1>
                                                                                                                                                                                                                                        <p class="sub" id="status-msg">Mark your attendance</p>

                                                                                                                                                                                                                                            <div id="student-view">
                                                                                                                                                                                                                                                    <input type="text" id="name" placeholder="Full Name">
                                                                                                                                                                                                                                                            <input type="number" id="reg" placeholder="Reg No (e.g., 101)">
                                                                                                                                                                                                                                                                    <button id="btn-mark" onclick="markPresent()">I am Here üôã‚Äç‚ôÇÔ∏è</button>
                                                                                                                                                                                                                                                                            <div id="success-msg" class="success">‚úÖ Marked successfully!</div>
                                                                                                                                                                                                                                                                                </div>

                                                                                                                                                                                                                                                                                    <div id="admin-view" class="hidden">
                                                                                                                                                                                                                                                                                            <div class="admin-bar">
                                                                                                                                                                                                                                                                                                        <span>Current Count:</span>
                                                                                                                                                                                                                                                                                                                    <div class="count" id="count-display">0</div>
                                                                                                                                                                                                                                                                                                                            </div>

                                                                                                                                                                                                                                                                                                                                    <div id="student-list" class="list-container">
                                                                                                                                                                                                                                                                                                                                                </div>

                                                                                                                                                                                                                                                                                                                                                        <button class="reset-btn" onclick="clearList()">üóëÔ∏è CLEAR LIST (Next Stop)</button>
                                                                                                                                                                                                                                                                                                                                                            </div>

                                                                                                                                                                                                                                                                                                                                                                <span class="toggle" onclick="toggleView()">Leader Login</span>
                                                                                                                                                                                                                                                                                                                                                                </div>

                                                                                                                                                                                                                                                                                                                                                                <script>
                                                                                                                                                                                                                                                                                                                                                                    // ============================================
                                                                                                                                                                                                                                                                                                                                                                        // üîë SETUP: PASTE YOUR SUPABASE KEYS BELOW
                                                                                                                                                                                                                                                                                                                                                                            // ============================================
                                                                                                                                                                                                                                                                                                                                                                                const SUPABASE_URL = 'https://tffrnkpxxxhyxztmqhxv.supabase.co'; 
                                                                                                                                                                                                                                                                                                                                                                                    const SUPABASE_KEY = 'sb_publishable_uLOLSgwdg6NKnL-ehvjNtA_1WVS8ium';
                                                                                                                                                                                                                                                                                                                                                                                        // ============================================

                                                                                                                                                                                                                                                                                                                                                                                            // Initialize Supabase
                                                                                                                                                                                                                                                                                                                                                                                                const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

                                                                                                                                                                                                                                                                                                                                                                                                    // --- STUDENT FUNCTION ---
                                                                                                                                                                                                                                                                                                                                                                                                        async function markPresent() {
                                                                                                                                                                                                                                                                                                                                                                                                                const name = document.getElementById('name').value.trim();
                                                                                                                                                                                                                                                                                                                                                                                                                        const reg = document.getElementById('reg').value.trim();
                                                                                                                                                                                                                                                                                                                                                                                                                                const btn = document.getElementById('btn-mark');
                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                if (!name || !reg) return alert("Please fill in Name and Reg No.");

                                                                                                                                                                                                                                                                                                                                                                                                                                                        btn.disabled = true;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                btn.innerText = "Saving...";

                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const { error } = await supabase.from('attendance').insert([{ student_name: name, reg_no: reg }]);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                if (error) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            alert("Error: " + error.message);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        btn.disabled = false;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    btn.innerText = "I am Here üôã‚Äç‚ôÇÔ∏è";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            } else {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        document.getElementById('success-msg').style.display = 'block';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    document.getElementById('name').value = '';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                document.getElementById('reg').value = '';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        setTimeout(() => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        document.getElementById('success-msg').style.display = 'none';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        btn.disabled = false;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        btn.innerText = "I am Here üôã‚Äç‚ôÇÔ∏è";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }, 2500);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // --- LEADER FUNCTIONS ---
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // 1. Subscribe to Live Changes
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                supabase.channel('custom-all-channel')
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    .on('postgres_changes', { event: '*', schema: 'public', table: 'attendance' }, (payload) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if (payload.eventType === 'INSERT') {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        addStudentRow(payload.new);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                } else if (payload.eventType === 'DELETE') {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            document.getElementById('student-list').innerHTML = ''; // Clear UI
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        updateCount(0);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    })
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        .subscribe();

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // 2. Fetch Initial List
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                async function fetchList() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const { data, error } = await supabase
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    .from('attendance')
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                .select('*')
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            .order('created_at', { ascending: false });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const list = document.getElementById('student-list');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        list.innerHTML = '';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                if (data) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            updateCount(data.length);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        data.forEach(addStudentRow);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        // 3. Helper: Add Row to HTML
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            function addStudentRow(student) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const list = document.getElementById('student-list');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            const div = document.createElement('div');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    div.className = 'student-row';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            div.innerHTML = `<strong>${student.student_name}</strong> <span class="reg-badge">${student.reg_no}</span>`;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    list.prepend(div);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            updateCount(list.children.length);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // 4. Helper: Update Counter
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        function updateCount(num) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                document.getElementById('count-display').innerText = num;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        // 5. Clear List (Reset for new location)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            async function clearList() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (confirm("Are you sure you want to CLEAR the list for the next place?")) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // Delete all rows where ID > 0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            const { error } = await supabase.from('attendance').delete().gt('id', 0);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // --- VIEW TOGGLE ---
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                function toggleView() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const studentView = document.getElementById('student-view');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const adminView = document.getElementById('admin-view');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                if (adminView.classList.contains('hidden')) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            const pass = prompt("Leader Password:");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (pass === "1234") {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        studentView.classList.add('hidden');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        adminView.classList.remove('hidden');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        document.getElementById('status-msg').innerText = "Live Monitoring Mode";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        fetchList();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            } else {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        studentView.classList.remove('hidden');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    adminView.classList.add('hidden');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                document.getElementById('status-msg').innerText = "Mark your attendance";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </script>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </body>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </html>